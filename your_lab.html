<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheMuLab - Your Lab</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="chemistry_craft.css">
    <script src="js/auth.js"></script>
    <script src="js/route-protection.js"></script>
</head>
<body>
    <div class="app-container">
        <div class="top-bar">
            <span class="logo">CheMuLab</span>
            <button id="sidebarToggle" aria-label="Toggle sidebar">â˜°</button>
            <div class="nav-links">
            </div>
            <div id="userStatus" class="sign-in">
                <div class="sidebar-icon">&#128100;</div>
                <span id="userStatusText">Sign In</span>
            </div>
        </div>

        <div class="sidebar">
            <a href="index.html" class="sidebar-item active">
                <div class="sidebar-icon">&#127968;</div> Home
            </a>
            <a href="your_lab.html" class="sidebar-item">
                <div class="sidebar-icon">&#129514;</div> Your Lab
            </a>
            <!--<a href="friends_lab.html" class="sidebar-item"> 
                <div class="sidebar-icon">&#128100;</div> Friends Lab
            </a> -->
            <a href="elements.html" class="sidebar-item">
                <div class="sidebar-icon">&#9883;</div> Elements
            </a>
            <a href="progress_tracker.html" class="sidebar-item">
                <div class="sidebar-icon">&#128197;</div> Progress Tracker
            </a>
            <!--<a href="leaderboard.html" class="sidebar-item">
                <div class="sidebar-icon">&#127942;</div> Leaderboard
            </a> -->
            <a href="about.html" class="sidebar-item">
                <div class="sidebar-icon">&#8505;</div> About
            </a>
        </div>

        <div class="main-content">
            <!-- Debug panel: shows current user and stored user_data (for troubleshooting) -->
            <div id="debugPanel" style="position:fixed;right:12px;bottom:12px;background:rgba(0,0,0,0.6);color:#fff;padding:8px;border-radius:6px;z-index:9999;font-size:12px;max-width:300px;">
                <div><strong>Debug</strong></div>
                <div id="debugUser">User: (none)</div>
                <pre id="debugData" style="white-space:pre-wrap;max-height:200px;overflow:auto;margin:6px 0 0;padding:6px;background:rgba(255,255,255,0.06);color:#fff;border-radius:4px;font-size:11px;">no data</pre>
                <button id="debugRefresh" style="margin-top:6px;padding:4px 6px;border-radius:4px;border:none;cursor:pointer;">Refresh</button>
            </div>
            <div class="lab-interface">
                <div class="elements-panel">
                    <h3>Elements</h3>
                    <div class="search-bar">
                        <input type="text" id="elementSearch" placeholder="Search elements...">
                    </div>
                    <div class="element-grid" id="elementGrid">
                        <!-- Elements will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="crafting-area">
                    <div class="crafting-slots">
                        <div class="crafting-slot" id="slot1" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="slot-label">Drop First Element</div>
                        </div>
                        <div class="plus-sign">+</div>
                        <div class="crafting-slot" id="slot2" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="slot-label">Drop Second Element</div>
                        </div>
                    </div>
                    <button class="combine-btn" id="combineBtn" disabled>Combine Elements</button>
                    <div class="result-area" id="resultArea">
                        <div class="result-slot">
                            <div class="slot-label">Result will appear here</div>
                        </div>
                    </div>
                </div>

                <div class="discoveries-panel">
                    <h3>Your Discoveries</h3>
                    <div class="discoveries-list" id="discoveriesList">
                        <!-- Discoveries will be added here -->
                    </div>
                </div>
            </div>
        </div>
        <script src="script.js"></script>
        <script src="js/discovery-service.js"></script>
        <script src="chemistry_craft.js"></script>
        <script>
            // Debug panel behavior
            document.addEventListener('DOMContentLoaded', () => {
                const btn = document.getElementById('debugRefresh');
                const userEl = document.getElementById('debugUser');
                const dataEl = document.getElementById('debugData');

                function refreshDebug() {
                    const user = (window.AuthService && AuthService.getCurrentUser && AuthService.getCurrentUser());
                    if (user) {
                        userEl.textContent = 'User: ' + user.username;
                        const key = 'chemulab_user_data_' + user.username;
                        const raw = localStorage.getItem(key);
                        try {
                            dataEl.textContent = raw ? JSON.stringify(JSON.parse(raw), null, 2) : '(no data)';
                        } catch (e) {
                            dataEl.textContent = raw;
                        }
                    } else {
                        userEl.textContent = 'User: (none)';
                        dataEl.textContent = '(no data)';
                    }
                }

                btn.addEventListener('click', refreshDebug);
                // auto refresh on load
                refreshDebug();
            });
        </script>
    </div>
</body>
</html>